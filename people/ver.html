<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pessoas - Sistema Aura</title>
  <link rel="icon" href="../../Aurinha.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      background: radial-gradient(circle at top left, #1a001f, #000);
      font-family: 'Poppins', sans-serif;
      color: #fff;
      margin: 0;
      padding: 40px;
      text-align: center;
    }
    h1 {
      color: #d6b2ff;
      text-shadow: 0 0 10px rgba(180, 0, 255, 0.7);
    }
    .top-buttons {
      display: flex;
      justify-content: space-between;
      max-width: 1000px;
      margin: 20px auto;
    }
    button {
      background: linear-gradient(90deg, #9b4dff, #b86bff);
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      transform: scale(1.05);
      background: linear-gradient(90deg, #b86bff, #d6aaff);
    }
    .list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      max-width: 1000px;
      margin: 30px auto;
    }
    .card {
      background: rgba(50, 0, 80, 0.4);
      border: 1px solid rgba(200, 150, 255, 0.3);
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(180, 0, 255, 0.2);
      padding: 20px;
      transition: 0.3s;
    }
    .card:hover { transform: scale(1.04); }
    .card img {
      width: 80px; height: 80px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 0 12px rgba(180, 0, 255, 0.4);
      margin-bottom: 10px;
    }
    .card h3 { margin: 0; color: #fff; }
    .card p { color: #c8b6ff; font-size: 0.9rem; margin: 3px 0; }
    .card-actions button { margin: 3px; font-size: 0.85rem; }
    .status { color: #caa8ff; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>üë• Pessoas Registradas</h1>
  <div class="top-buttons">
    <button onclick="window.location.href='../../dashboard.html'">‚¨Ö Voltar</button>
    <button onclick="window.location.href='criar.html'">‚ûï Novo</button>
  </div>
  <div id="pessoasList" class="list"></div>
  <p id="statusMsg" class="status">Carregando...</p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc, orderBy, query } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
    import { firebaseConfig } from "../../firebaseConfig.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const list = document.getElementById("pessoasList");
    const statusMsg = document.getElementById("statusMsg");

    async function loadPessoas() {
      list.innerHTML = "";
      statusMsg.textContent = "Carregando...";
      try {
        const q = query(collection(db, "people"), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        if (snap.empty) {
          statusMsg.textContent = "Nenhuma pessoa cadastrada.";
          return;
        }
        statusMsg.textContent = "";
        snap.forEach((docSnap) => {
          const p = docSnap.data();
          const photo = p.photoURL || "../../default-avatar.png";
          const fac = p.faction || "‚Äî";
          const hier = p.hierarchy ? ` (${p.hierarchy})` : "";
          const card = document.createElement("div");
          card.classList.add("card");
          card.innerHTML = `
            <img src="${photo}" alt="${p.name}">
            <h3>${p.name}</h3>
            <p>Fac√ß√£o: ${fac}${hier}</p>
            <p>Telefone: ${p.phone || "‚Äî"}</p>
            <div class="card-actions">
              <button onclick="editarPessoa('${docSnap.id}')">‚úèÔ∏è Editar</button>
              <button onclick="excluirPessoa('${docSnap.id}', '${p.name}')">‚ùå Excluir</button>
            </div>`;
          list.appendChild(card);
        });
      } catch (err) {
        statusMsg.textContent = "‚ùå Erro: " + err.message;
      }
    }

    window.editarPessoa = (id) => window.location.href = `editar.html?id=${id}`;
    window.excluirPessoa = async (id, name) => {
      if (!confirm(`Excluir ${name}?`)) return;
      await deleteDoc(doc(db, "people", id));
      loadPessoas();
    };

    loadPessoas();
  </script>
</body>
</html>
